if(!("ace" in window)) {
	window.ace = {}
}
jQuery(function(a) {
	window.ace.click_event = a.fn.tap ? "tap" : "click"
});
jQuery(function() {
	ace.handle_side_menu();
	ace.main_container_fixed(true);
});
ace.handle_side_menu = function() {
	var cookies= {
		setCookie:function(key,val,day){
	        var date=new Date(); 
	        day =day || 100;
	        date.setTime(date.getTime()+day*24*3600*1000); //格式化为cookie识别的时间
			document.cookie=key+"="+val+"; expires="+date.toGMTString();
	    },
	    getCookie:function(key){
	        var cookies = document.cookie.replace(/[ ]/g,"");   
	        var arrCookie = cookies.split(";")   
	        var mapCahe = {}
	        for(var i=0;i<arrCookie.length;i++){    
	            var cookie= arrCookie[i].split("="); 
	            if(cookie){
	            	var cookieName = cookie[0];
	            	var cookieValue = cookie[1] || "";
	            	mapCahe[cookieName]=cookieValue;
	            }
	        }
	        return mapCahe[key] || "";
	     },
	     deleteCookie:function(key){
	         var date = new Date(); //获取当前时间
	         date.setTime(date.getTime()-10000); //将date设置为过去的时间
	         document.cookie = key+"=v; expires =" +date.toGMTString();//设置cookie
	    }
	};
	
	var sidebar_collapsed = function(){
		var sidebar = jQuery("#sidebar");
		if(!sidebar.hasClass("menu-min")){
			sidebar.addClass("menu-min");
			cookies.setCookie("ace.sidebar",true);
		}else{
			sidebar.removeClass("menu-min");
			cookies.setCookie("ace.sidebar",false);
		}
	};
	$("#menu-toggler").on(ace.click_event, function() {
		$("#sidebar").toggleClass("display");
		$(this).toggleClass("display");
		return false
	});
	var c = $("#sidebar").hasClass("menu-min");
	$("#sidebar-collapse").on(ace.click_event, function() {
		sidebar_collapsed()
	});
	var b = navigator.userAgent.match(/OS (5|6|7)(_\d)+ like Mac OS X/i);
	$(".nav-list").on(ace.click_event, function(h) {
		var g = $(h.target).closest("a");
		if(!g || g.length == 0) {
			return
		}
		c = $("#sidebar").hasClass("menu-min");
		if(!g.hasClass("dropdown-toggle")) {
			if(c && ace.click_event == "tap" && g.get(0).parentNode.parentNode == this) {
				var i = g.find(".menu-text").get(0);
				if(h.target != i && !$.contains(i, h.target)) {
					return false
				}
			}
			if(b) {
				document.location = g.attr("href");
				return false
			}
			return
		}
		var f = g.next().get(0);
		if(!$(f).is(":visible")) {
			var d = $(f.parentNode).closest("ul");
			if(c && d.hasClass("nav-list")) {
				return
			}
			d.find("> .open > .submenu").each(function() {
				if(this != f && !$(this.parentNode).hasClass("active")) {
					$(this).slideUp(200).parent().removeClass("open")
				}
			})
		} else {}
		if(c && $(f.parentNode.parentNode).hasClass("nav-list")) {
			return false
		}
		$(f).slideToggle(200).parent().toggleClass("open");
		return false
	})
};
ace.main_container_fixed = function(flag) {
	flag =flag || false;
	var mainContainer = $("#main-container");
	var navbarContainer = $("#navbar-container");
	if(flag){
		if(!mainContainer.hasClass("container")){
		   mainContainer.addClass("container");
		}
		if(!navbarContainer.hasClass("container")){
		   navbarContainer.addClass("container");
		}
	}else{
		mainContainer.removeClass("container");
		navbarContainer.removeClass("container");
	}
};
